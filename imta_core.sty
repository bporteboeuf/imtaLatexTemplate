%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% File Name:       imta_core
%
% Description:     Overall layout and colours of the IMT Atlantique
%                  LaTeX Template.
%
% Note:            /
%
% Limitations:     /
%
% Errors:          None known
%
% Dependencies:    anyfontsize
%                  geometry
%                  graphicx
%                  fancyhdr
%                  float
%                  fontenc
%                  inputenc
%                  pdfpages
%                  secsty
%                  tikz
%                  titling
%
% Author:          A. Foucault - armand.foucault@telecom-bretagne.eu
% Contributors:    B. Porteboeuf - benoit.porteboeuf@telecom-bretagne.eu
%
% University :     IMT Atlantique, Brest (France)
%
% TeX Environment: TeXLive + pdfLaTeX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Revision List:
% Version    Author   Date         Changes
% 1.0.0      AF       15.10.2017   First Draft
% 1.0.1      BP       31.10.2017   Original preamble .tex file changed
%                                  to a .sty package
% 1.1.0      BP       31.10.2017   Original imta.sty package split into
%                                  imt_core.sty and imta_extra.sty
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\NeedsTeXFormat{LaTeX2e}



%%%%%%%%%% PACKAGES %%%%%%%%%%

% Document geometry management
\RequirePackage[a4paper, margin=2cm, top=3cm]{geometry}

% Images management
\RequirePackage{graphicx}

% Floats management
\RequirePackage{float}

% Output font management
\RequirePackage[T1]{fontenc}

% Document encoding management
\RequirePackage[utf8]{inputenc}

% Include external pdf documents
% Used for generating the cover
\RequirePackage{pdfpages}

% Fancy headers and footers
\RequirePackage{fancyhdr}

% Pictures drawing
\RequirePackage{tikz}

% Metadata access
\RequirePackage{titling}

% Arbitrary font size
\RequirePackage{anyfontsize}

% Section styling
\RequirePackage{sectsty}



%%%%%%%%%% COLORS %%%%%%%%%%

% The three colors of IMTA: green, light blue, and dark blue
\definecolor{imtaGreen}{RGB}{164, 210, 51}
\definecolor{imtaLightBlue}{RGB}{0, 184, 222}
\definecolor{imtaDarkBlue}{RGB}{12, 35, 64}
\definecolor{imtaGray}{RGB}{87, 87, 87}

% Colors related to code formatting
\definecolor{imtaCodeBackground}{RGB}{245, 245, 245}
\definecolor{imtaInlineCodeBackground}{RGB}{230, 230, 230}



%%%%%%%%%% GENERAL SETTINGS %%%%%%%%%%

\raggedbottom



%%%%%%%%%% PACKAGES SETTINGS %%%%%%%%%%


% graphicx
%\setkeys{Gin}{width=\linewidth}


% fancyhdr
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\fancyhead[L]{\thetitle}
\fancyhead[R]{\theauthor}
\fancyfoot[C]{\thepage}

\fancypagestyle{imtaFirstpage}{%
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
}



%%%%%%%%%% COMMANDS %%%%%%%%%%

% \subtitle
% Command for the cover's subtitle
\newcommand{\subtitleValue}{}
\newcommand{\subtitle}[1]{%
    \renewcommand{\subtitleValue}{#1}
}


% \imtaQuestion
% Output "Question" followed by the current question number
% The \imtaQuestionReset command should be called after each new section or subsection,
% in order to resest the question counter
\newcounter{imtaQuestionCounter}
\newcommand{\imtaQuestion}{%
    \stepcounter{imtaQuestionCounter}%
    \subsection*{Question \arabic{imtaQuestionCounter}}%
}


% \imtaQuestionReset
% Reset the question counter
\newcommand{\imtaQuestionReset}{%
    \setcounter{imtaQuestionCounter}{0}%
}


% \imtaLogo
% Include the IMTA logo according to the given width
\newcommand\imtaLogo[1]{\includegraphics[width = #1]{imta_logo.pdf}}


% \imtaLogoTikz
% Outputs the IMT Atlantique logo using tikz according to the given width
\newcommand{\imtaLogoTikz}[1]{%
    \resizebox{3cm}{!}{%
        \begin{tikzpicture}[every node/.style={inner sep=0,outer sep=0}]
            \draw (-1,1) -- (8,1);
            \draw (-1,0) -- (8,0);
            \draw (-1,-1) -- (8,-1);
            \draw (-1,-2) -- (8,-2);
            \draw (-1,-3) -- (8,-3);
            \draw (-1,-4) -- (8,-4);
            \draw (-1,-5) -- (8,-5);
            \draw (-1,1) -- (-1,-5);
            \draw (0,1) -- (0,-5);
            \draw (1,1) -- (1,-5);
            \draw (2,1) -- (2,-5);
            \draw (3,1) -- (3,-5);
            \draw (4,1) -- (4,-5);
            \draw (5,1) -- (5,-5);
            \draw (6,1) -- (6,-5);
            \draw (7,1) -- (7,-5);
            \draw (8,1) -- (8,-5);
    
            \fill[imtaLightBlue] (0,0) -- (2,0) -- (3,-1) -- (4,0) -- (4,-1) -- %
                                          (5,0) -- (7,0) -- (5,-2) -- (5,-1) -- (4,-1) -- %
                                          (4,-2) -- (2,-2) -- (2,0) -- (0,-2) -- (0,0);
            \node [anchor=west] at (0,-2.5) {\LARGE\fontfamily{phv}\selectfont \textbf{IMT Atlantique}};
            \node [anchor=north west] at (0,-3) {\Large\fontfamily{phv}\selectfont Bretagne - Pays de la Loire};
            \node [anchor=south west] at (0,-4) {\Large\fontfamily{phv}\selectfont École Mines-Télécom};
        \end{tikzpicture}  
    }
}



% \imtaMaketitlepage
% Output the title page, with regards for the IMT Atlantique official style
% This is a twocolumns robust titlepage command
\makeatletter

% \geteltsize gets the 1/10th of the smallest dimension of the paper used
\def\geteltsize{%
    \ifdim \paperwidth < \paperheight
    \paperwidth/10
    \else
    \paperheight/10
    \fi%
}

% \titleLayout is the actual layout used for the cover by \imtaMaketitlepage
\def\titleLayout{%
%    \thispagestyle{empty}
    \thispagestyle{imtaFirstpage}
    \pagenumbering{gobble}
    \newgeometry{top = 1cm, bottom = 1cm, inner = 1cm, outer = 1cm}
    \begin{flushright}
        \begin{tikzpicture}
        \filldraw[draw=imtaGreen,fill=imtaGreen] (-3\geteltsize,0) -- (0,-3\geteltsize) -- (0\geteltsize,0) -- cycle;
        \filldraw[draw=imtaLightBlue,fill=imtaLightBlue] (-2.24\geteltsize,-3\geteltsize) -- (0,-5.24\geteltsize) -- (0,-3\geteltsize) -- cycle;
        \filldraw[draw=imtaDarkBlue,fill=imtaDarkBlue] (-5.24\geteltsize,0) -- (-2.24\geteltsize,-3\geteltsize) -- (-5.24\geteltsize,-3\geteltsize) -- cycle;
        
        \node (date) [draw=none, text width=.95\textwidth, align=left, anchor=west] at (-.95\textwidth, -6\geteltsize) {
            \large\fontfamily{phv}\selectfont\thedate \\
            \large\fontfamily{phv}\selectfont\theauthor \vspace*{1.5cm}\\
            \textcolor{imtaGreen}{\fontsize{25}{40}\fontseries{b}\fontfamily{phv}\selectfont\thetitle} \vspace*{.5cm}\\
            \textcolor{imtaGreen}{\Large\fontfamily{phv}\selectfont\subtitleValue}};
        \end{tikzpicture}
        \vfill
        \begin{minipage}{.98\linewidth}
            \begin{flushleft}
                \imtaLogo{6.26cm}
            \end{flushleft}
        \end{minipage}
    \end{flushright}
    \cleardoublepage
    \restoregeometry
    \pagenumbering{arabic}
    \setcounter{page}{2}
}

\newcommand\imtaMaketitlepage{%
    \clearpage
    \if@twocolumn
        \onecolumn % we force it to a one column environment
        \titleLayout
        \twocolumn
    \else
        \titleLayout
    \fi
}
\makeatother


% \imtaSetIMTStyle
% Set a styling that conforms to the official report template
\newcommand{\imtaSetIMTStyle}{%
    % Set global font to Helvetica
    \usepackage{helvet}
    \renewcommand{\familydefault}{\sfdefault}

    % Set heading style
    \sectionfont{\bf\LARGE\color{imtaGreen}}
    \subsectionfont{\bf\Large\color{imtaGray}}
    \subsubsectionfont{\bf\large\color{imtaGray}}
    \paragraphfont{\color{imtaGray}}
    \subparagraphfont{\color{imtaGray}}

    % Set header and footer style
    \pagestyle{fancy}
    \fancyhead{}
    \fancyfoot{}
    \fancyhead[L]{\nouppercase\leftmark}
    \fancyfoot[R]{\thepage}
    \fancypagestyle{imtaFirstpage}{%
        \fancyhf{}
        \renewcommand{\headrulewidth}{0pt}
    }
}
